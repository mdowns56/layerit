(function(e){e.widget("mdowns.layerIt",{options:{layers:[],zIndex:0},_create:function(){var a=this.options;this.element.addClass("layerIt");this.element.css({"background-color":a.bgColor});for(var b=0;b<a.layers.length;b++)this._createLayer(a.layers[b],a.zIndex+b)},_setOption:function(a,b){"bgColor"===a&&this.element.css("background-color",b);this._super(a,b)},_setOptions:function(a){this._super(a)},_getLayerIndex:function(a){for(var b=this.options.layers,c=0;c<b.length;c++){var d=b[c];if(d&&d.name&&
a===d.name)return c}return-1},add:function(a){this._addLayer(a)},update:function(a,b){var c=this._getLayerIndex(a);0<=c&&(e.extend(!0,this.options.layers[c].image,b),this._drawLayer(a))},hide:function(a){this._hideLayer(a)},show:function(a){this._showLayer(a)},remove:function(a){this._removeLayer(a)},move:function(a,b){var c=this._getLayerIndex(a);if(!(0>c)){if("forward"==b){if(c==this.options.layers.length-1)return;c++}else if("back"==b){if(0==c)return;c--}else throw"Direction '"+b+"' not supported.";
this._moveLayer(a,c)}},color:function(a){this._setOption("bgColor",a)},_createLayer:function(a,b){var c=e("<img id='layer_"+a.name+"'/>").css({position:"absolute",zIndex:b});this.element.append(c);this._drawLayer(a.name)},_hideLayer:function(a){this._getLayerElement(a).hide()},_showLayer:function(a){this._getLayerElement(a).show()},_getLayerElement:function(a){return e("img#layer_"+a)},_addLayer:function(a){var b=this._getLayerIndex(a.name);0<=b||(b=this.options.layers,b.push(a),b=b.length-1,this._createLayer(a,
b))},_removeLayer:function(a){var b=this._getLayerIndex(a);0>b||(this.options.layers.splice(b,1),this._getLayerElement(a).remove())},_moveLayer:function(a,b){var c=this._getLayerIndex(a);if(!(0>c)){var d=this.options.layers;d.splice(b,0,d.splice(c,1)[0]);this._redrawLayers()}},_drawLayer:function(a){var b=this._getLayerIndex(a);0>b||(b=this.options.layers[b],a=this._getLayerElement(a).attr("src",b.image.src),b.image.css&&a.css(b.image.css))},_redrawLayers:function(){for(var a=this.options.layers,
b=0;b<a.length;b++){var c=a[b],d={zIndex:this.options.zIndex+b};e.extend(d,c.image.css);this._getLayerElement(c.name).attr("src",c.image.src).css(d)}},_destroy:function(){this.element.removeClass("layerIt");this.element.css({"background-color":"transparent"});for(var a=this.options.layers.length,b=0;b<a;b++)this._removeLayer(b)}})})(jQuery);
